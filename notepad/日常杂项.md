## Linux

### 系统
#### 查看系统
```bash
cat /etc/lsb-release # 发行版
cat /proc/version
uname -a  #内核

```
#### 设置时区

```bash
timedatectl set-timezone Asia/Shanghai
```

### 编辑
#### VIM中文乱码

```bash
vim /etc/vim/vimrc
set fileencodings=utf-8,ucs-bom,gb18030,gbk,gb2312,cp936
set termencoding=utf-8
set encoding=utf-8
```
#### sed

```bash
sed -i 's#需要替换的文字#替换后的文字#g' config.js
sed -i 's/需要替换的文字/替换后的文字/g' config.js # 同上

sed -i "/匹配文字/ a换行后需要添加的文字" config.js

```

## Git
### 基础
```bash
echo "# Hello World" >> README.md
git init
git add README.md
git commit -m "first commit"
git remote add origin https://github.com/<USERNAME>/<REPO-NAME>.git
git push -u origin master
```

#### 查看所有分支(包括远程)
```bash
git branch -a
```

#### 删除分支
```bash
#删除本地分支
git branch -d [branchname]
#删除远程分支
git push origin --delete [branchname]
```

#### 新建分支
```bash
#新建分支并切换到指定分支
git checkout -b 本地分支名 origin/远程分支名

#新建本地远程分支，并关联
git branch 本地分支名
git push origin 本地分支名:远程分支名
```

#### tags
```bash
# 查看tag，创建tag
git tag
git tag v0.0.1
git push origin v0.0.1

#删除tag
git tag -d v0.0.1
git push origin :refs/tags/v0.0.1
```


## Mysql

### 创建数据库
```sql
--创建名称为“testdb”数据库，并设定编码集为utf8
CREATE DATABASE IF NOT EXISTS testdb DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
```

### 创建用户并授权
```sql
--创建了一个名为：test 密码为：1234 的用户
 create user 'test'@'localhost' identified by '1234';


--删除用户“test”
drop user 'test'@'localhost' ;
--若创建的用户允许任何电脑登陆，删除用户如下
drop user 'test'@'%';


修改用户密码
mysql> set password for test =password('1122');
mysql> set password for root@localhost = password('123456');
需要刷新
mysql> update  mysql.user set  password=password('1234')  where user='test'


--授予用户通过任意IP对数据库“testdb”的全部权限
grant all privileges on testdb.* to 'test'@'%' identified by '1234';  
grant create,alter,drop,select,insert,update,delete on testdb.* to test@'%'; 
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION; 

--刷新权限
flush privileges; 

查看用户权限
show grants for test;
```

### 导入导出数据
```bash
#导出
mysqldump -u dbuser -p 数据库名 > dbname.sql
mysqldump -u dbuser -p 数据库名 表名> dbname_tables.sql
mysqldump -u dbuser -p -d --add-drop-table dbname >d:/dbname_db.sql
#-d 没有数据 --add-drop-table 在每个create语句之前增加一个drop table

#导入
login mysql then:
source /home/ubuntu/dbname.sql
```


## Docker

阿里DOCKER镜像加速

```bash
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://slot7tfp.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

阿里云私有Docker Registry

```bash
docker login --username=15010277240 registry.cn-hangzhou.aliyuncs.com     //password:123123
docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/[namespaces阿里云中创建]/[镜像名]:[镜像版本号]
docker push registry.cn-hangzhou.aliyuncs.com/[namespaces阿里云中创建]/[镜像名]:[镜像版本号]
```

```
docker build -t zzz/docker-mysql .

docker run -ti --name mysql_test -e MYSQL_ROOT_PASSWORD=123456 -p3306:3306 -idt zzz/docker-mysql:latest

docker logs -f mysql_test

docker exec -it mysql_test /bin/bash

mysql -uroot -p123456
```

## Kubernetes

```bash
//minkube
minikube docker-env          //查看docker环境变量
minikube dashboard
```

```bash
kubectl cluster-info          //查看集群信息

kubectl get nodes            //获取节点

//通过kubectl run 部署一个名为kubernetes-bootcamp的容器 --image指定容器镜像 --port指定对外暴露的端口
//Deployment可以理解为应用
//Pod 理解为一组容器的集合，一些息息相关的容器放在一个Pod中，同一个Pod中的容器共享IP和Port空间也就是在同一个命名空间。Pod 在Kubernetes是最小的调度单位，同一Pod中的容器始终被一起调度
kubectl run kubernetes-bootcamp --image=docker.io/jocatalin/kubernetes-bootcamp:v1 --port=8080

kubectl get pods //查看当前pod     --all-namespaces

kubectl describe pod etcd-global-9002d   //查看详细pod

//将容器的8080端口映射到节点端口，随机分配的端口。也是创建服务
kubectl expose deployment/kubernetes-bootcamp --name=z2 --type="NodePort" --port 8080

kubectl get services   //查看创建的服务。可以看到应用被映射到哪个端口

curl localhost:32253 //通过端口号访问应用。32253是刚才查看服务里面找到的对应端口

kubectl get deployments

kubectl scale deployments/kubernetes-bootcamp --replicas=3   //增加三个副本

kubectl scale deployments/kubernetes-bootcamp --replicas=2   //删除一个副本

//更新image，将v1版本升级为v2版本
kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=jocatalin/kubernetes-bootcamp:v2

kubectl rollout undo deployments/kubernetes-bootcamp    //回退image


//通过kubectl exec 可以直接连接到对应的节点
kubectl exec kubernetes-bootcamp-6c5cfd894b-gt6fc -it -- bash -il
kubectl exec kubernetes-bootcamp-6c5cfd894b-gt6fc -it -n namespaces /bin/bash

//查看Pod下对应容器的日志， 使用-f可以直接监听文件变化
kubectl logs -f <POD_NAME> -c <CONTAINER_NAME>

//Endpoint => (Pod Ip + ContainerPort)
kubectl get endpoints

kubectl get namespace

// -n namespaces -l labelkey=labelvalue
kubectl delete deployment -n zzz -l run=test-ubuntu

kubectl run --generator=run-pod/v1 -n zzz -i --tty test-busybox --image=busybox
```

### Ingress    

k8s 网关，服务暴露

* ingress-nginx deploy    [官网](https://kubernetes.github.io/ingress-nginx/deploy/)  [博客](https://blog.csdn.net/java_zyq/article/details/82179107)


## 微服务

分别使用Spring cloud Kubernetes微服务的实现组件

|  | Spring Cloud | Kubernetes |
| :--- | :--- | :--- |
| 服务发现 | Eureka , Consul | kube-dns Services |
| 服务通讯 | Ribbon , Feign | Thrift , grpc |
| 配置管理 | Config , Bus | ConfigMap |
| 负载均衡 | Ribbon RestTemplate | Services , Ingress |
| 网关 | Zuul , Gateway |  |
| 链路跟踪 | Sleuth , Zipkin,Jaeger | OpenTracing |
| 容错熔断器 | Hystrix, Sentinel |  |
| 安全模块 | Security |  |
| 分布式日志 | ELK | ELK |
| 任务管理 | Batch | Jobs |
| 分布式事务 | seata |  |

#### 优秀案例

[Microservice Architectures With Spring Cloud and Docker](https://dzone.com/articles/microservice-architecture-with-spring-cloud-and-do)

[Microservice Architecture with Spring Boot, Spring Cloud and Docker ](https://github.com/sqshq/PiggyMetrics)


